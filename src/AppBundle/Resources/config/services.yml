services:
    # Global http client for application level, silent/verbose, based on debug option
    # Alias: veslo.app.http.client.base

    veslo.app.http.client.silent:
        class: GuzzleHttp\Client
        arguments:
            - '%veslo.app.http.client.config%'

    veslo.app.http.client.verbose:
        class: Veslo\AppBundle\Http\Client\VerboseClient
        lazy: true
        arguments:
            - '@monolog.logger.app.http'
            - '@serializer'
            - '@veslo.app.http.client.silent'

    veslo.app.http.client.batman:
        class: Veslo\AppBundle\Http\Client\Batman
        lazy: true
        arguments:
            - '@veslo.app.http.client.base'
            - '@veslo.app.http.proxy.manager.alfred'
            - '%veslo.app.http.client.stability_options%'

    veslo.app.http.proxy.manager.alfred:
        class: Veslo\AppBundle\Http\Proxy\Manager\Alfred
        lazy: true
        arguments:
            - '@veslo.app.http.proxy.locator.static_array_locator'

    veslo.app.http.proxy.locator.static_array_locator:
        class: Veslo\AppBundle\Http\Proxy\Locator\StaticArrayLocator
        lazy: true
        arguments:
            - '%veslo.app.http.client.proxy.static_list%'

    veslo.app.amqp_client:
        class: Bunny\Client
        arguments:
            - '%veslo.app.amqp_client.options%'

    veslo.app.workflow.vacancy.research.marking_store:
        class: Veslo\AppBundle\Workflow\Vacancy\Research\MarkingStore

    veslo.app.workflow.vacancy.research.conveyor:
        class: Veslo\AppBundle\Workflow\Vacancy\Research\Conveyor
        arguments:
            - '@monolog.logger.app.workflow'
            - '@workflow.vacancy_research'
            - '@serializer'
            - '@veslo.app.amqp_client'
            - '%veslo.app.workflow.vacancy_research.transitions.queue_prefix%'

    veslo.app.menu.builder:
        class: Veslo\AppBundle\Menu\Builder
        arguments:
            - '@knp_menu.factory'
            - '@event_dispatcher'
        tags:
            -   name: knp_menu.menu_builder
                method: createMainMenu
                alias: main

    veslo.app.cache.array.no_serialization:
        # TODO: [upgrade] Will be available in framework bundle by default since 4.1 release
        # https://github.com/symfony/symfony/commit/f92e03de974fd1728582cbc124e570a0a5376434
        # parent: 'cache.adapter.array'
        # TODO: move to Symfony\Contracts\Cache\CacheInterface since 4.2 release
        class: Symfony\Component\Cache\Adapter\ArrayAdapter
        arguments:
            - 0
            - false
        calls:
            -   method: setLogger
                arguments:
                    - '@?monolog.logger'
        tags:
            -   name: 'cache.pool'
                clearer: 'cache.default_clearer'
            -   name: 'monolog.logger'
                channel: 'cache'
